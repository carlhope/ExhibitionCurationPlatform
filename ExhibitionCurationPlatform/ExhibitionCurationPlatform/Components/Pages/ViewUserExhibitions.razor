@page "/exhibitions"
@using ExhibitionCurationPlatform.Models
@using ExhibitionCurationPlatform.Services.Interfaces
@inject IExhibitionService ExhibitionService

<PageTitle>Your Exhibitions</PageTitle>

@if (exhibitions == null)
{
    <p>Loading exhibitions...</p>
}
else if (!exhibitions.Any())
{
    <p>No exhibitions found for this curator.</p>
}
else
{
    <div class="exhibition-list">
        @foreach (var exhibition in exhibitions)
        {
            <div class="exhibition-card border rounded p-3 mb-4">
                <div class="card-title h4">@exhibition.Title</div>
                <p>@exhibition.Description</p>
                <p><strong>Scheduled:</strong> @(exhibition.ScheduledDate?.ToShortDateString() ?? "Not scheduled")</p>
                <p><strong>Created:</strong> @exhibition.CreatedAt.ToShortDateString()</p>
                <p><strong>Layout:</strong> @exhibition.Layout</p>
                <p><strong>Theme:</strong> @exhibition.Theme</p>
                <p><strong>Artworks:</strong> @exhibition.Artworks.Count</p>

                @if (exhibition.Artworks?.Any() == true)
                {
                    <div class="artwork-list row row-cols-1 row-cols-md-2 g-3">
                        @foreach (var artwork in exhibition.Artworks)
                        {
                            <div class="col">
                                <div class="card h-100">
                                    <img src="@artwork.ImageUrl" class="card-img-top" alt="@artwork.Title" style="object-fit: cover; height: 200px;" />
                                    <div class="card-body">
                                        <h5 class="card-title">@artwork.Title</h5>
                                        <p class="card-text">
                                            <strong>Artist:</strong> @artwork.Artist<br />
                                            <strong>Date:</strong> @artwork.Date
                                        </p>
                                        <a class="btn btn-sm btn-primary" href="@($"/artwork/{artwork.Source.ToLower()}/{artwork.Id}")">
                                            View Details
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        }
    </div>
}

@code {
    private List<Exhibition> exhibitions;

    protected override async Task OnInitializedAsync()
    {
        
        var curator = "User"; // Placeholder until Identity is wired in
        exhibitions = await ExhibitionService.GetExhibitionsByCuratorAsync(curator);
    }
}
