@page "/exhibitions"
@attribute [Authorize]
@inject AuthenticationStateProvider AuthenticationStateProvider
@using ExhibitionCurationPlatform.Components.UI
@using ExhibitionCurationPlatform.Models
@using ExhibitionCurationPlatform.Services.Interfaces
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@inject IExhibitionService ExhibitionService

<PageTitle>Your Exhibitions</PageTitle>

@if (exhibitions == null)
{
    <p>Loading exhibitions...</p>
}
else if (!exhibitions.Any())
{
    <p>No exhibitions found for this curator.</p>
}
else
{
    <div class="exhibition-list">
        @foreach (var exhibition in exhibitions)
        {
            <div class="exhibition-card border rounded p-3 mb-4">
                <div class="card-title h4">@exhibition.Title</div>
                <p>@exhibition.Description</p>
                <p><strong>Scheduled:</strong> @(exhibition.ScheduledDate?.ToShortDateString() ?? "Not scheduled")</p>
                <p><strong>Created:</strong> @exhibition.CreatedAt.ToShortDateString()</p>
                <p><strong>Layout:</strong> @exhibition.Layout</p>
                <p><strong>Theme:</strong> @exhibition.Theme</p>
                <p><strong>Artworks:</strong> @exhibition.Artworks.Count</p>

                @if (exhibition.Artworks?.Any() == true)
                {
                    <div class="artwork-list row row-cols-1 row-cols-lg-2 row-cols-xxl-3 g-3">
                        @foreach (var artwork in exhibition.Artworks)
                        {
                            <div class="col">
                               <ArtworkCard Artwork="artwork" />
                            </div>
                        }
                    </div>
                }
            </div>
        }
    </div>
}

@code {
    private List<Exhibition> exhibitions;

    protected override async Task OnInitializedAsync()
    {

        var curator = await GetUserId();
        exhibitions = await ExhibitionService.GetExhibitionsByCuratorAsync(curator);
    }
    private async Task<string> GetUserId()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        var userId = user.FindFirst(c => c.Type == ClaimTypes.NameIdentifier)?.Value;
        return userId;
    }
}
